{% extends 'admin.html' %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="container-fluid px-2 px-md-3 mt-3 mt-md-4">
    <div class="row justify-content-center">
        <div class="col-12 col-md-10 col-lg-8">
            <div class="card border-danger shadow-sm">
                <div class="card-header bg-danger text-white">
                    <h4 class="mb-0 fs-5 fs-md-4">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <span class="d-none d-sm-inline">Confirmation d'Annulation de Contrat</span>
                        <span class="d-inline d-sm-none">Annuler Contrat</span>
                    </h4>
                </div>
                <div class="card-body p-3 p-md-4">
                    <!-- Alerte attention -->
                    <div class="alert alert-warning mb-3 mb-md-4">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Attention:</strong> Cette action va annuler le contrat et tous les objets liés.
                        <span class="d-none d-sm-inline">Les données seront conservées pour traçabilité mais marquées comme annulées.</span>
                    </div>

                    <!-- Informations du contrat -->
                    <h5 class="fs-6 fs-md-5 mb-3">Informations du Contrat</h5>
                    <div class="table-responsive">
                        <table class="table table-sm table-borderless mb-3 mb-md-4">
                            <tr>
                                <th class="text-nowrap" width="140">Numéro BL:</th>
                                <td><strong>{{ contrat.numero_bl }}</strong></td>
                            </tr>
                            <tr>
                                <th class="text-nowrap">Client:</th>
                                <td>{{ contrat.client.nom }}</td>
                            </tr>
                            <tr>
                                <th class="text-nowrap">Transitaire:</th>
                                <td>{{ contrat.transitaire.nom }}</td>
                            </tr>
                            <tr>
                                <th class="text-nowrap">Montant Total:</th>
                                <td><strong>{{ contrat.montant_total }} CFA</strong></td>
                            </tr>
                            <tr>
                                <th class="text-nowrap">Date Début:</th>
                                <td>{{ contrat.date_debut|date:"d/m/Y" }}</td>
                            </tr>
                        </table>
                    </div>

                    <hr class="my-3">

                    <!-- Statistiques d'objets -->
                    <h5 class="fs-6 fs-md-5 mb-3">Objets qui seront Annulés</h5>
                    <div class="row g-2 g-md-3 text-center mb-3 mb-md-4">
                        <div class="col-4">
                            <div class="card bg-light h-100">
                                <div class="card-body p-2 p-md-3">
                                    <h6 class="mb-1 mb-md-2 fs-7 fs-md-6">Missions</h6>
                                    <h3 class="text-primary mb-0 fs-4 fs-md-3">{{ nb_missions }}</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="card bg-light h-100">
                                <div class="card-body p-2 p-md-3">
                                    <h6 class="mb-1 mb-md-2 fs-7 fs-md-6">Cautions</h6>
                                    <h3 class="text-warning mb-0 fs-4 fs-md-3">{{ nb_cautions }}</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="card bg-light h-100">
                                <div class="card-body p-2 p-md-3">
                                    <h6 class="mb-1 mb-md-2 fs-7 fs-md-6">Paiements</h6>
                                    <h3 class="text-info mb-0 fs-4 fs-md-3">{{ nb_paiements }}</h3>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Info traçabilité -->
                    <div class="alert alert-info mb-3 mb-md-4">
                        <i class="fas fa-check-circle me-2"></i>
                        <strong>Traçabilité:</strong>
                        <span class="d-none d-md-inline">Tous ces objets seront conservés en base de données
                        avec un statut "annulé" pour permettre l'audit et la traçabilité complète.</span>
                        <span class="d-inline d-md-none">Données conservées avec statut "annulé".</span>
                    </div>

                    <!-- Formulaire -->
                    <form method="post" class="needs-validation" novalidate>
                        {% csrf_token %}

                        <div class="mb-3 mb-md-4">
                            <label for="raison" class="form-label fw-bold">
                                <i class="fas fa-comment-alt me-2"></i>
                                Raison de l'Annulation *
                            </label>
                            <textarea
                                name="raison"
                                id="raison"
                                class="form-control"
                                rows="3"
                                required
                                placeholder="Ex: Client a annulé la commande, Problème technique, etc."
                            ></textarea>
                            <small class="text-muted d-block mt-1">
                                Cette raison sera enregistrée dans le commentaire du contrat pour traçabilité.
                            </small>
                        </div>

                        <!-- Boutons d'action -->
                        <div class="d-flex flex-column flex-sm-row justify-content-between gap-2">
                            <a href="{% url 'contrat_list' %}" class="btn btn-secondary order-2 order-sm-1">
                                <i class="fas fa-times me-2"></i>Annuler
                            </a>
                            <button type="submit" class="btn btn-danger order-1 order-sm-2">
                                <i class="fas fa-ban me-2"></i>Confirmer l'Annulation
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* Responsive optimizations */
    @media (max-width: 576px) {
        /* Titres plus petits sur mobile */
        h4 {
            font-size: 1rem !important;
        }

        h5 {
            font-size: 0.95rem !important;
        }

        h6 {
            font-size: 0.8rem !important;
        }

        /* Taille de police personnalisée */
        .fs-7 {
            font-size: 0.75rem !important;
        }

        /* Tables responsive */
        .table {
            font-size: 0.85rem;
        }

        .table th {
            font-size: 0.8rem;
            padding: 0.4rem 0.5rem;
        }

        .table td {
            padding: 0.4rem 0.5rem;
        }

        /* Alertes plus compactes */
        .alert {
            font-size: 0.85rem;
            padding: 0.75rem;
        }

        /* Cards statistiques */
        .card-body h3 {
            font-size: 1.5rem !important;
        }

        /* Boutons full width sur mobile */
        .btn {
            width: 100%;
            font-size: 0.9rem;
        }

        /* Icônes légèrement plus petites */
        .fas {
            font-size: 0.9em;
        }

        /* Padding réduit pour container */
        .container-fluid {
            padding-left: 0.5rem;
            padding-right: 0.5rem;
        }

        /* Form controls */
        textarea.form-control {
            font-size: 0.9rem;
        }

        .form-label {
            font-size: 0.9rem;
        }

        small, .text-muted {
            font-size: 0.75rem !important;
        }
    }

    @media (min-width: 577px) and (max-width: 768px) {
        /* Tablette */
        h4 {
            font-size: 1.25rem !important;
        }

        .alert {
            font-size: 0.9rem;
        }

        .btn {
            font-size: 0.95rem;
        }
    }

    /* Amélioration hover sur desktop */
    @media (min-width: 992px) {
        .card {
            transition: transform 0.2s;
        }

        .btn {
            transition: all 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
    }
</style>

<script>
// Validation Bootstrap
(function () {
    'use strict'
    var forms = document.querySelectorAll('.needs-validation')
    Array.prototype.slice.call(forms)
        .forEach(function (form) {
            form.addEventListener('submit', function (event) {
                if (!form.checkValidity()) {
                    event.preventDefault()
                    event.stopPropagation()
                }
                form.classList.add('was-validated')
            }, false)
        })
})()
</script>
{% endblock %}
